<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User</title>
    
</head>

<body>
    <nav>
        <ul>
            <li>
                <h5><label id="fname">Hello, </label></h5>
            </li>
            <li>
                <a href="Dashboard.html">Dashboard</a>
            </li>
            <li>
                <a href="User.html">User</a>
            </li>
            <li>
                <a href="UserSession.html">Login Session</a>
            </li>
            <li>
                <a onclick="logout();">Logout</a>
            </li>
        </ul>

    </nav>

    <h1>Add User</h1>

    <div class="Container1">
        <input type="text" name="name" id="name1" placeholder="Name" class="data">
        <input type="text" name="email" id="email" placeholder="Email" class="data">
        <input type="password" name="password" id="password" placeholder="Password" class="data">
        <input type="date" name="birthDate" id="birthDate" placeholder="dateOfBirth" class="data">
    </div>

    <input type="button" id="addUser" name="login" value="Add User" onclick="insertUser();">

    <h1>User List</h1>

    <script type="text/javascript">
        
        document.write('<table id="table" border="1" class="table-data" id="table-user">');
        document.write('<thread>');

        document.write('<th>Name</th>');
        document.write('<th>Email</th>');
        document.write('<th>Password</th>');
        document.write('<th>Birthdate</th>');
        document.write('<th>Age</th>');
        document.write('<th colspan="2">Actions</th>');

        document.write('</thread>');
        document.write('<tbody>');
        document.write('<tr>');


        var array_user = localStorage.getItem('array_user');
        var items = JSON.parse(array_user);

        array_user = items;

       
        if (array_user) {
            for (var k = 0; k < array_user.length; k++) {
                document.write('<td>' + array_user[k].name + '</td>');
                document.write('<td>' + array_user[k].email + '</td>');
                document.write('<td>' + array_user[k].password + '</td>');
                document.write('<td>' + array_user[k].userbirthDate + '</td>');
                document.write('<td>' + getAge(array_user[k].userbirthDate) + '</td>');

                document.write('<td><a href="#" name="aTag" id="aTag" value="' + k + '" onClick="editData(' + array_user[k].index + ')">Edit</a></td>');

                document.write('<td>');


                document.write("<a href='#' onClick='deleteData(" + array_user[k].index + ")'>Delete</a>");
                document.write("</td>");

                document.write('</tr>');

                
            }
        }
        function deleteData(index) {
            var items = localStorage.getItem('array_user');
            var array_user = JSON.parse(items);
            var index_of;

            for (var s = 0; s < array_user.length; s++) {
                index_of = array_user.indexOf(array_user[s]);
                console.log(index_of);

                if (index != 0) {
                    array_user.splice(index, 1);
                    console.log(index_of);
                }
                if (index == 0) {
                    array_user.splice(index, 1);
                }

                localStorage.setItem('array_user', JSON.stringify(array_user));
                location.reload();
                break;
            }
            for (var g = 0; g < array_user.length; g++) {
                index_of = array_user.indexOf(array_user[g]);
                if (index_of != array_user[g].index) {
                    array_user[g].index = index_of;
                }
            }
            localStorage.setItem('array_user', JSON.stringify(array_user));
            location.reload();
        }

        function editData(index) {
            var array_user1 = localStorage.getItem('array_user');
            var items = JSON.parse(array_user1);


            let link = document.querySelector("#aTag");
            let target1 = link.getAttribute('value');
            link.setAttribute('value', index);

            for (var j = 0; j < items.length; j++) {
                if (index == items[j].index) {
                    document.getElementById('name1').value = items[j].name;
                    document.getElementById('email').value = items[j].email;
                    document.getElementById('password').value = items[j].password;
                    document.getElementById('birthDate').value = items[j].userbirthDate;
                    document.getElementById("addUser").value = "Update";
                }
            }
            
        }

        document.write('</tbody></table>');	
    </script>
    

    <script>
        document.getElementById("fname").innerHTML = "Hello " + sessionStorage.getItem("fname");
    </script>

</body>
<script src="User.js"></script>
</html>